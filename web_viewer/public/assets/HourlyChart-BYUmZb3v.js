import{r as s,j as r}from"./index-HNXD38gs.js";import{C as k}from"./react-apexcharts.min-B6cFfxDy.js";const u="Solar PV",y="Battery",g="Grid",b=s.forwardRef(({className:w},C)=>{const[n,d]=s.useState([]),[S,f]=s.useState(!1),h=s.useRef(!1),[a,E]=s.useState(!0),j=s.useMemo(()=>{const e=[],t=[],i=[],p=[],x=[];return n.forEach(c=>{const l=new Date(c[1]).getTime();e.push({x:l,y:c[2]}),t.push({x:l,y:c[3]}),i.push({x:l,y:c[4]}),p.push({x:l,y:c[5]}),x.push({x:l,y:c[6]})}),[{name:u,data:e},{name:y,data:t},{name:g,data:i},{name:"Consumption",data:p},{name:"SOC",data:x}]},[n]),o=s.useCallback(async()=>{if(h.current)return;h.current=!0;const t=await(await fetch("/hourly-chart")).json();d(t),h.current=!1},[d]);s.useImperativeHandle(C,()=>({updateItem(e){if(!a)return;const t=n[n.length-1];if(JSON.stringify(t)===JSON.stringify(e))return;const i=[...n];t[0]===e[0]?i.splice(n.length-1,1,e):i.push(e),d(i)}}));const m=s.useCallback(()=>{!document.hidden&&a&&o()},[o,a]);s.useEffect(()=>(o(),document.addEventListener("visibilitychange",m),()=>{document.removeEventListener("visibilitychange",m)}),[o,a,m]),s.useEffect(()=>{const e=window.matchMedia("(prefers-color-scheme: dark)");e.matches&&f(!0),e.addEventListener("change",t=>f(t.matches))},[]);const v=s.useCallback(()=>{a||o(),E(!a)},[a,o]),N=s.useMemo(()=>{const e=new Date;return e.setHours(0),e.setMinutes(0),e.setSeconds(0),e},[]);return r.jsxs("div",{className:`card hourly-chart col ${w||""}`,children:[r.jsxs("div",{className:"row justify-space-between",children:[r.jsx("div",{className:"hourly-chart-title",children:"Hourly Chart"}),r.jsxs("div",{className:"row hourly-chart-buttons",children:[r.jsx("button",{onClick:v,children:a?"Pause auto update":"Allow auto update"}),r.jsx("button",{disabled:!a,onClick:()=>o(),children:"Update"})]})]}),r.jsx("div",{className:"hourly-chart-content col flex-1",children:n.length?r.jsx(k,{type:"line",series:j,options:{chart:{toolbar:{show:!1},height:300},colors:["rgb(112, 173, 70)","rgb(90, 155, 213)","rgb(246, 104, 103)","rgb(255, 164, 97)","rgb(128, 0, 128)"],stroke:{width:3},theme:{mode:S?"dark":"light"},xaxis:{type:"datetime",min:N.getTime(),labels:{datetimeUTC:!1,format:"HH:mm"}},yaxis:[{seriesName:u,title:{text:"Power (W)"}},{seriesName:u,show:!1},{seriesName:u,show:!1},{seriesName:u,show:!1},{seriesName:"SOC",opposite:!0,tickAmount:10,min:0,max:100,title:{text:"SOC (%)"}}],tooltip:{x:{format:"HH:mm:ss"},y:{formatter(e,t){return t.seriesIndex===4?`${e}%`:`${Math.abs(e)} W`},title:{formatter(e,t){return e===y?t.series[1][t.dataPointIndex]<0?`${e} charge:`:`${e} discharge:`:e===g?"Import Grid Power:":`${e}:`}}}}}}):r.jsx("div",{className:"flex-1 align-center justify-center col",children:"Loadding..."})})]})});b.displayName="HourlyChart";const R=s.memo(b);export{R as default};
