import{r,j as e}from"./index-GjNwB43g.js";import{G as n}from"./GeneralValue-CSjJ2AgC.js";import{C as _}from"./react-apexcharts.min-Di4dtRqf.js";function N({total:s,ePVDay:t}){return e.jsxs("div",{className:"row justify-space-between align-center",children:[e.jsx("img",{src:"/assets/icon_solor_yielding.png"}),e.jsxs("div",{className:"yield-texts summary-item-content-texts ",children:[e.jsx(n,{value:t,unit:" kWh"}),e.jsx("div",{className:"description",children:"Yield today"}),s&&e.jsxs(e.Fragment,{children:[e.jsx(n,{value:s.pv.toFixed(1),unit:" kWh"}),e.jsx("div",{className:"description",children:"Total Yield"})]})]})]})}const w=r.memo(N);function h(s,t=1){return s>0?s.toFixed(t):s}const y=(s,t=1)=>{const d=Math.pow(10,t);return Math.round(s*d)/d};function k({totalYield:s,charge:t,gridExport:d,label:a}){const[j,o]=r.useState(!1);let i,x,c,l;return s?(i=s-t-d,x=h(i/s*100),c=h(t/s*100),l=h(d/s*100)):(i=0,x=0,c=0,l=0),r.useEffect(()=>{const u=window.matchMedia("(prefers-color-scheme: dark)");u.matches&&o(!0),u.addEventListener("change",m=>o(m.matches))},[]),e.jsxs("div",{className:"yield-chart row flex-1",children:[e.jsxs("div",{className:"texts col flex-1 align-start justify-space-between",children:[e.jsxs("div",{className:"yield-chart-load",children:[x,"% Load ",a]}),e.jsxs("div",{className:"yield-chart-charge",children:[c,"% Charge ",a]}),e.jsxs("div",{className:"yield-chart-export",children:[l,"% Export ",a]}),e.jsx("div",{className:"yield-chart-total",children:e.jsxs("strong",{children:[a," ",y(s)," kWh"]})})]}),e.jsx("div",{className:"chart row align-center",children:e.jsx(_,{type:"pie",series:[y(i),y(t),y(d)],options:{chart:{width:100,type:"pie"},colors:["#FF718F","#5CC9A0","#F2A474"],theme:{mode:j?"dark":"light"},labels:[`Load ${a} PV`,`Charge ${a} PV`,`Export ${a} PV`],legend:{show:!1}}})})]})}const f=r.memo(k);function C({invertData:s}){const[t,d]=r.useState(!1),[a,j]=r.useState(!1),o=r.useRef(!1),[i,x]=r.useState(),[c,l]=r.useState(0),u=r.useCallback(()=>{switch(c){case 0:l(1);break;case 1:l(2);break;default:l(0);break}},[c]),m=r.useCallback(async()=>{if(!o.current)try{console.log("Fetching total..."),o.current=!0;const v=await(await fetch("/total")).json();x(v)}catch(g){console.error("Fetch total error",g)}finally{o.current=!1}},[]),p=r.useCallback(()=>{document.hidden||m()},[m]);return r.useEffect(()=>(m(),document.addEventListener("visibilitychange",p),()=>{document.removeEventListener("visibilitychange",p)}),[m,p]),e.jsxs("div",{className:"summary row",children:[e.jsxs("div",{className:"yield summary-item flex-1 col",onClick:u,children:[e.jsx("div",{className:"summary-item-title",children:"Solar Yield"}),e.jsxs("div",{className:"summary-item-content col flex-1",children:[c===0&&e.jsx(w,{total:i,ePVDay:s.e_pv_day}),c===1&&e.jsx(f,{label:"Today",totalYield:s.e_pv_day,charge:s.e_chg_day,gridExport:s.e_to_grid_day}),c===2&&e.jsx(f,{label:"Total",totalYield:(i==null?void 0:i.pv)||0,charge:(i==null?void 0:i.battery_charged)||0,gridExport:(i==null?void 0:i.grid_export)||0})]})]}),e.jsxs("div",{className:"battery summary-item flex-1",onClick:()=>d(!t),children:[e.jsx("div",{className:"summary-item-title",children:t?"Battery Charged":"Battery Discharge"}),e.jsx("div",{className:"summary-item-content",children:e.jsxs("div",{className:"row justify-space-between align-center",children:[e.jsx("img",{src:"/assets/icon_battery_discharging.png"}),e.jsxs("div",{className:"summary-item-content-texts",children:[e.jsx(n,{value:t?s.e_chg_day:s.e_dischg_day,unit:" kWh"}),e.jsx("div",{className:"description",children:t?"Charged today":"Discharged today"}),i&&e.jsxs(e.Fragment,{children:[e.jsx(n,{value:h(t?i.battery_charged:i.battery_discharged),unit:" kWh"}),e.jsxs("div",{className:"description",children:["Total ",t?"Charged":"Discharged"]})]})]})]})})]}),e.jsxs("div",{className:"feed summary-item flex-1",onClick:()=>j(!a),children:[e.jsx("div",{className:"summary-item-title ",children:a?"Feed-in Energy":"Import"}),e.jsx("div",{className:"summary-item-content",children:e.jsxs("div",{className:"row justify-space-between align-center",children:[e.jsx("img",{src:a?"/assets/icon_feed_in_energy.png":"/assets/icon_import.png"}),e.jsx("div",{className:"feed-texts summary-item-content-texts",children:e.jsxs("div",{className:"col",children:[e.jsx(n,{value:a?s.e_to_grid_day:s.e_to_user_day,unit:" kWh"}),e.jsx("div",{className:"description",children:a?"Today Export":"Today Import"}),i&&e.jsxs(e.Fragment,{children:[e.jsx(n,{value:h(a?i.grid_export:i.grid_import),unit:" kWh"}),e.jsxs("div",{className:"description",children:["Total ",a?"Export":"Import"]})]})]})})]})})]}),e.jsxs("div",{className:"comsumption summary-item flex-1",children:[e.jsx("div",{className:"summary-item-title ",children:"Comsumption"}),e.jsx("div",{className:"summary-item-content",children:e.jsxs("div",{className:"row justify-space-between align-center",children:[e.jsx("img",{src:"/assets/icon_consumption.png"}),e.jsxs("div",{className:"feed-texts summary-item-content-texts",children:[e.jsx(n,{value:(s.e_inv_day+s.e_to_user_day+s.e_eps_day-s.e_rec_day).toFixed(1),unit:" kWh"}),e.jsx("div",{className:"description",children:"Today Used"}),i&&e.jsxs(e.Fragment,{children:[e.jsx(n,{value:h(i.consumption),unit:" kWh"}),e.jsx("div",{className:"description",children:"Total Used"})]})]})]})})]})]})}const E=r.memo(C);export{E as default};
