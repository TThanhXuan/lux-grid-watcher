import{r as s,j as r}from"./index-BMg5kuNt.js";import{C}from"./react-apexcharts.min-IsgorTQv.js";const p="Battery",x=s.forwardRef(({className:y},u)=>{const[n,h]=s.useState([]),[g,d]=s.useState(!1),l=s.useRef(!1),w=s.useMemo(()=>{const e=[],t=[],a=[],m=[],f=[];return n.forEach(o=>{const i=new Date(o[1]).getTime();e.push({x:i,y:o[2]}),t.push({x:i,y:o[3]}),a.push({x:i,y:o[4]}),m.push({x:i,y:o[5]}),f.push({x:i,y:o[6]})}),[{name:"PV",data:e},{name:p,data:t},{name:"Grid",data:a},{name:"Consumption",data:m},{name:"SOC",data:f}]},[n]),c=s.useCallback(async()=>{if(l.current)return;l.current=!0;const t=await(await fetch("/hourly-chart")).json();h(t),l.current=!1},[h]);return s.useImperativeHandle(u,()=>({updateItem(e){const t=n[n.length-1];if(JSON.stringify(t)===JSON.stringify(e))return;const a=[...n];t[0]===e[0]?a.splice(n.length-1,1,e):a.push(e),h(a)}})),s.useEffect(()=>{c(),document.addEventListener("visibilitychange",()=>{document.hidden||c()})},[c,u]),s.useEffect(()=>{const e=window.matchMedia("(prefers-color-scheme: dark)");e.matches&&d(!0),e.addEventListener("change",t=>d(t.matches))},[]),r.jsxs("div",{className:`card hourly-chart ${y||""}`,children:[r.jsxs("div",{className:"row justify-space-between",children:[r.jsx("div",{className:"hourly-chart-title",children:"Hourly Chart"}),r.jsx("div",{className:"row",children:r.jsx("button",{onClick:()=>c(),children:"Update"})})]}),r.jsx("div",{className:"hourly-chart-content",children:r.jsx(C,{type:"line",series:w,options:{chart:{toolbar:{show:!1},height:300},colors:["rgb(112, 173, 70)","rgb(90, 155, 213)","rgb(246, 104, 103)","rgb(255, 164, 97)","rgb(128, 0, 128)"],stroke:{width:3},theme:{mode:g?"dark":"light"},xaxis:{type:"datetime",labels:{datetimeUTC:!1}},yaxis:[{seriesName:"PV",title:{text:"Power (W)"}},{seriesName:"PV",show:!1},{seriesName:"PV",show:!1},{seriesName:"PV",show:!1},{seriesName:"SOC",opposite:!0,tickAmount:10,min:0,max:100,title:{text:"SOC (%)"}}],tooltip:{x:{format:"HH:mm:ss"},y:{formatter(e,t){return t.seriesIndex===4?`${e}%`:`${Math.abs(e)} W`},title:{formatter(e,t){return console.log(t),e===p?t.series[1][t.dataPointIndex]<0?`${e} charge:`:`${e} discharge:`:`${e}:`}}}}}})})]})});x.displayName="HourlyChart";const j=s.memo(x);export{j as default};
