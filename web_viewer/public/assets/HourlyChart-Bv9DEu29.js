import{r as t,j as r}from"./index-pKDAJnNt.js";import{C as w}from"./react-apexcharts.min-DwbJHnQ8.js";const p=t.forwardRef(({className:x},h)=>{const[a,c]=t.useState([]),[y,d]=t.useState(!1),l=t.useRef(!1),g=t.useMemo(()=>{const e=[],s=[],m=[],u=[],f=[];return a.forEach(o=>{const n=new Date(o[1]).getTime();e.push({x:n,y:o[2]}),s.push({x:n,y:o[3]}),m.push({x:n,y:o[4]}),u.push({x:n,y:o[5]}),f.push({x:n,y:o[6]})}),[{name:"PV",data:e},{name:"Battery",data:s},{name:"Grid",data:m},{name:"Consumption",data:u},{name:"SOC",data:f}]},[a]),i=t.useCallback(async()=>{if(l.current)return;l.current=!0;const s=await(await fetch("/hourly-chart")).json();c(s),l.current=!1},[c]);return t.useImperativeHandle(h,()=>({updateItem(e){console.log(e),a[a.length-1][0]===e[0]?a.splice(a.length-1,1,e):a.push(e),c(a)}})),t.useEffect(()=>{i(),document.addEventListener("visibilitychange",()=>{document.hidden||i()})},[i,h]),t.useEffect(()=>{const e=window.matchMedia("(prefers-color-scheme: dark)");e.matches&&d(!0),e.addEventListener("change",s=>d(s.matches))},[]),r.jsxs("div",{className:`card hourly-chart ${x||""}`,children:[r.jsxs("div",{className:"row justify-space-between",children:[r.jsx("div",{className:"hourly-chart-title",children:"Hourly Chart"}),r.jsx("div",{className:"row",children:r.jsx("button",{onClick:()=>i(),children:"Update"})})]}),r.jsx("div",{className:"hourly-chart-content",children:r.jsx(w,{type:"line",series:g,options:{chart:{toolbar:{show:!1},height:300},colors:["rgb(112, 173, 70)","rgb(90, 155, 213)","rgb(246, 104, 103)","rgb(255, 164, 97)","rgb(128, 0, 128)"],stroke:{width:3},theme:{mode:y?"dark":"light"},xaxis:{type:"datetime",labels:{datetimeUTC:!1}},yaxis:[{seriesName:"PV",title:{text:"Power (W)"}},{seriesName:"PV",show:!1},{seriesName:"PV",show:!1},{seriesName:"PV",show:!1},{seriesName:"SOC",opposite:!0,tickAmount:10,min:0,max:100,title:{text:"SOC (%)"}}],tooltip:{x:{format:"HH:mm:ss"},y:{formatter(e,s){return s.seriesIndex===4?`${e}%`:`${e} W`}}}}})})]})});p.displayName="HourlyChart";const j=t.memo(p);export{j as default};
