import{r as a,j as e}from"./index-CqVdXGey.js";import{G as r}from"./GeneralValue-B-lBKyns.js";import{C as f}from"./react-apexcharts.min-CYTx08gF.js";function _({total:s,ePVDay:c}){return e.jsxs("div",{className:"row justify-space-between",children:[e.jsx("img",{src:"/assets/icon_consumption.png"}),e.jsxs("div",{className:"yield-texts text-right",children:[e.jsx(r,{value:c,unit:" kWh"}),e.jsx("div",{className:"description",children:"Yield today"}),s&&e.jsxs(e.Fragment,{children:[e.jsx(r,{value:s.pv.toFixed(1),unit:" kWh"}),e.jsx("div",{className:"description",children:"Total Yield"})]})]})]})}const N=a.memo(_),x=s=>Math.round(s*10)/10;function w({totalYield:s,charge:c,gridExport:o,label:t}){const[u,n]=a.useState(!1),i=s-c-o,y=(i/s*100).toFixed(1),d=(c/s*100).toFixed(1),m=(o/s*100).toFixed(1);return a.useEffect(()=>{const h=window.matchMedia("(prefers-color-scheme: dark)");h.matches&&n(!0),h.addEventListener("change",l=>n(l.matches))},[]),e.jsxs("div",{className:"yield-chart row flex-1",children:[e.jsxs("div",{className:"texts col flex-1 align-start justify-space-between",children:[e.jsxs("div",{className:"yield-chart-load",children:[y,"% Load ",t]}),e.jsxs("div",{className:"yield-chart-charge",children:[d,"% Charge ",t]}),e.jsxs("div",{className:"yield-chart-export",children:[m,"% Export ",t]}),e.jsx("div",{className:"yield-chart-total",children:e.jsxs("strong",{children:[t," ",x(s)," kWh"]})})]}),e.jsx("div",{className:"chart row align-center",children:e.jsx(f,{type:"pie",series:[x(i),x(c),x(o)],options:{chart:{width:100,type:"pie"},colors:["#FF718F","#5CC9A0","#F2A474"],theme:{mode:u?"dark":"light"},labels:[`Load ${t} PV`,`Charge ${t} PV`,`Export ${t} PV`],legend:{show:!1}}})})]})}const g=a.memo(w);function k({invertData:s}){const[c,o]=a.useState(!1),[t,u]=a.useState(!1),n=a.useRef(!1),[i,y]=a.useState(),[d,m]=a.useState(0),h=a.useCallback(()=>{switch(d){case 0:m(1);break;case 1:m(2);break;default:m(0);break}},[d]),l=a.useCallback(async()=>{if(!n.current)try{console.log("Fetching total..."),n.current=!0;const v=await(await fetch("/total")).json();y(v)}catch(p){console.error("Fetch total error",p)}finally{n.current=!1}},[]),j=a.useCallback(()=>{document.hidden||l()},[l]);return a.useEffect(()=>(l(),document.addEventListener("visibilitychange",j),()=>{document.removeEventListener("visibilitychange",j)}),[l,j]),e.jsxs("div",{className:"summary row",children:[e.jsxs("div",{className:"yield summary-item flex-1 col",onClick:h,children:[e.jsx("div",{className:"summary-item-title",children:"Solar Yield"}),e.jsxs("div",{className:"summary-item-content col flex-1",children:[d===0&&e.jsx(N,{total:i,ePVDay:s.e_pv_day}),d===1&&e.jsx(g,{label:"Today",totalYield:s.e_pv_day,charge:s.e_chg_day,gridExport:s.e_to_grid_day}),d===2&&e.jsx(g,{label:"Total",totalYield:(i==null?void 0:i.pv)||0,charge:(i==null?void 0:i.battery_charged)||0,gridExport:(i==null?void 0:i.grid_export)||0})]})]}),e.jsxs("div",{className:"battery summary-item flex-1",onClick:()=>o(!c),children:[e.jsx("div",{className:"summary-item-title",children:c?"Battery Charged":"Battery Discharge"}),e.jsx("div",{className:"summary-item-content",children:e.jsxs("div",{className:"row justify-space-between",children:[e.jsx("img",{src:"/assets/icon_battery_discharging.png"}),e.jsxs("div",{className:"text-right",children:[e.jsx(r,{value:c?s.e_chg_day:s.e_dischg_day,unit:" kWh"}),e.jsx("div",{className:"description",children:c?"Charged today":"Discharged today"}),i&&e.jsxs(e.Fragment,{children:[e.jsx(r,{value:(c?i.battery_charged:i.battery_discharged).toFixed(1),unit:" kWh"}),e.jsxs("div",{className:"description",children:["Total ",c?"Charged":"Discharged"]})]})]})]})})]}),e.jsxs("div",{className:"feed summary-item flex-1",onClick:()=>u(!t),children:[e.jsx("div",{className:"summary-item-title ",children:t?"Feed-in Energy":"Import"}),e.jsx("div",{className:"summary-item-content",children:e.jsxs("div",{className:"row justify-space-between",children:[e.jsx("img",{src:t?"/assets/icon_feed_in_energy.png":"/assets/icon_import.png"}),e.jsx("div",{className:"feed-texts text-right",children:e.jsxs("div",{className:"col",children:[e.jsx(r,{value:t?s.e_to_grid_day:s.e_to_user_day,unit:" kWh"}),e.jsx("div",{className:"description",children:t?"Today Export":"Today Import"}),i&&e.jsxs(e.Fragment,{children:[e.jsx(r,{value:(t?i.grid_export:i.grid_import).toFixed(1),unit:" kWh"}),e.jsxs("div",{className:"description",children:["Total ",t?"Export":"Import"]})]})]})})]})})]}),e.jsxs("div",{className:"comsumption summary-item flex-1",children:[e.jsx("div",{className:"summary-item-title ",children:"Comsumption"}),e.jsx("div",{className:"summary-item-content",children:e.jsxs("div",{className:"row justify-space-between",children:[e.jsx("img",{src:"/assets/icon_consumption.png"}),e.jsxs("div",{className:"feed-texts text-right",children:[e.jsx(r,{value:(s.e_inv_day+s.e_to_user_day+s.e_eps_day-s.e_rec_day).toFixed(1),unit:" kWh"}),e.jsx("div",{className:"description",children:"Today Used"}),i&&e.jsxs(e.Fragment,{children:[e.jsx(r,{value:i.consumption.toFixed(1),unit:" kWh"}),e.jsx("div",{className:"description",children:"Total Used"})]})]})]})})]})]})}const E=a.memo(k);export{E as default};
